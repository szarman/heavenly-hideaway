
<!DOCTYPE html>

<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XF63CJ7GW2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XF63CJ7GW2');
</script>
<meta charset="utf-8"/>
<title>Availability | Heavenly Hideaway</title>
<link href="style.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js"></script>
<meta name="hh-worker-url" content="https://<YOUR-WORKER-NAME>.<YOUR-SUBDOMAIN>.workers.dev/">
</head>
<body>
<header>
<h1>Availability</h1>
</header>
<nav>
<a href="index.html">Home</a>
<a href="the_cabin.html">The Cabin</a>
<a href="availability.html">Availability</a>
<a href="reviews.html">Reviews</a>

<div class="dropdown">
<span class="dropbtn">Things to Do</span>
<div class="dropdown-content">
<a href="water.html">Water Adventures</a>
<a href="golf.html">Golf Courses</a>
<a href="biking.html">Biking Routes</a>
<a href="hiking.html">Hiking Trails</a>
<a href="restaurants.html">Restaurants</a>
<a href="festivals.html">Festivals &amp; Events</a>
</div>
</div>
<a href="faq.html">FAQ</a>
<a href="house_rules.html">House Rules</a>
<a href="gallery.html">Gallery</a>
<div class="dropdown">
    <span class="dropbtn">Log In</span>
    <div class="dropdown-content">
        <a href="friends.html">Friends</a>
        <a href="owner.html">Owner</a>
    </div>
</div>
<a href="contact.html">Contact</a>
<a href="book_now.html">Book NOW!</a>
</nav>
<section>
<h2>Check Our Calendar</h2>
<p>Below you can view up-to-date availability for Heavenly Hideaway.</p>
<iframe frameborder="0" height="600" scrolling="no" src="https://calendar.google.com/calendar/embed?src=3chbs0bdvhnf48c87kbj6m4csir2rk7a%40import.calendar.google.com&amp;ctz=America%2FNew_York" style="border:0" width="800"></iframe>
</section>
<footer>
<p>Â© 2025 Heavenly Hideaway</p>
</footer>
<div id="hh-calendar"></div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const el = document.getElementById('hh-calendar');
    if (!el) return;

    // Read workers.dev URL (or route) from meta tag
    const meta = document.querySelector('meta[name="hh-worker-url"]');
    const workerUrl = (meta && meta.content && meta.content.trim()) || '/api/airbnb-ics';
    const encodedIcs = encodeURIComponent('https://www.airbnb.com/calendar/ical/1409413532693959161.ics?s=c1a709120161ee05cfbe995ffefef8fb');

    const cal = new FullCalendar.Calendar(el, {
      initialView: 'dayGridMonth',
      height: 'auto',
      events: async (info, success, failure) => {
        async function tryFetch(url) {
          const r = await fetch(url, { credentials: 'omit' });
          if (!r.ok) throw new Error('HTTP ' + r.status + ' @ ' + url);
          return r.json();
        }
        try {
          // Prefer secret-based Worker (no query string)
          let base = workerUrl.endsWith('/') ? workerUrl.slice(0, -1) : workerUrl;
          try {
            const data = await tryFetch(base);
            success(data);
            return;
          } catch (e1) {
            // Fallback: append ?url=encoded ICS
            try {
              const data = await tryFetch(base + '?url=' + encodedIcs);
              success(data);
              return;
            } catch (e2) {
              // Last resort: local route (if workerUrl was absolute and route exists later)
              if (base.startsWith('http')) {
                try {
                  const data = await tryFetch('/api/airbnb-ics?url=' + encodedIcs);
                  success(data);
                  return;
                } catch (e3) {
                  console.error(e3);
                  failure(e2);
                }
              } else {
                failure(e2);
              }
            }
          }
        } catch (err) {
          console.error(err);
          failure(err);
        }
      },
      eventDisplay: 'background' // Shade reserved ranges
    });

    cal.render();
  });
</script>
</body>
</html>
